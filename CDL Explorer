/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var cdl2014 = ee.Image("USDA/NASS/CDL/2014"),
    champaign = ee.FeatureCollection("users/RobertFPaul/ChampaignCounty");
/***** End of imports. If edited, may not auto-convert in the playground. *****/

// Create a mask of all pixels matching CDL crop class indices
// for the specified years within the extent
var CDL_Mask = function(years, crops, extent) {
  var year;
  var crop_img;
  // Result-holding raster filled with 1 values
  var result_img = ee.Image(0).clip(extent);
  
  // Go through each year to extract
  for (year in years) {
    // Get CDL for current year and clip it
    crop_img = ee.Image('USDA/NASS/CDL/' + years[year]);
    crop_img = crop_img.select('cropland').clip(extent);
    
    crop_img = crop_img.remap(crops, // from
      ee.List.repeat(1, crops.length), // to
      0); // default value
    
    // Union combined crop mask with previous mask results
    result_img = result_img.or(crop_img);
  }
  // Return resulting mask
  return result_img;
}

// Get the CDL image for the year
var FetchCDLYear = function(year) {
  // Start and end dates
  var start = ee.Date.fromYMD(year, 01, 01);
  var end = ee.Date.fromYMD(year, 12, 31);
  // Get the cropland layer for the year
  var result = ee.ImageCollection('USDA/NASS/CDL')
    .filterDate(start,end)
    .select('cropland')
    .first(); // Specifically get the image
  result = ee.Image(result).clip(champaign);
  print(result)
  return result;
}

var FetchCovers = function(imageList, coverIDs) {
  // Remap coverID values as 1, everything else as 0
  var result = imageList.remap(coverIDs, // from
    ee.List.repeat(1, coverIDs.length), // to
    0); // default value
  return result;
}

// List of years from the CDL to fetch
var yearList = [2013, 2014, 2015, 2016, 2017];
// List of cover types (as integer IDs) to fetch
var coverTypes = [1, 5, 111];

var cdl_mapped = yearList.map(FetchCDLYear);
//cdl_mapped = FetchCovers(cdl_mapped, coverTypes);

// Get CDL of corn (1), soybean (5), and water (111) for 2017
var cdl_cult_water = CDL_Mask([2017], coverTypes, champaign);
// Get CDL of water for 2013-2017 inclusive
var cdl_water = CDL_Mask(yearList, [111], champaign);

print (cdl_cult_water);
print(cdl_mapped);

Map.addLayer(cdl_cult_water);
Map.addLayer(cdl_water);

//Export mask. Uncomment this when ready to export data.
/*Export.image.toCloudStorage({
  image: cdl_cult_water,
  description: 'CDL_Corn-Bean-Water',
  bucket: 'gee_export_kovi',
  fileNamePrefix: 'cbw_mask_2017',
  crs: "EPSG:32616",
  scale: 30,
  region: champaign,
  maxPixels: 1e13
});*/