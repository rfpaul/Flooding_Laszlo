/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var champaign = ee.FeatureCollection("users/RobertFPaul/ChampaignCounty");
/***** End of imports. If edited, may not auto-convert in the playground. *****/


// Load Sentinel-1 images to map Champaign County flooding.
// This script was originally written by Simon Ilyushchenko (GEE team)
// and adapted by Simon Gascoin (CNRS/CESBIO) and Michel Le Page (IRD/CESBIO)

// Default location
var pt = champaign;

// Load Sentinel-1 C-band SAR Ground Range collection (log scaling, VV co-polar)
var collection =  ee.ImageCollection('COPERNICUS/S1_GRD').filterBounds(pt)
.filter(ee.Filter.listContains('transmitterReceiverPolarisation', 'VV'))
.select('VV');

// Filter by date
var dry = collection.filterDate('2017-02-10', '2017-02-28').mosaic();
var wet = collection.filterDate('2017-04-29', '2017-05-08').mosaic();

// Threshold smoothed radar intensities to identify "flooded" areas.
var SMOOTHING_RADIUS = 100;
var DIFF_UPPER_THRESHOLD = -7; 

var diff_smoothed = wet.focal_median(SMOOTHING_RADIUS, 'circle', 'meters')
    .subtract(dry.focal_median(SMOOTHING_RADIUS, 'circle', 'meters'));

var diff_thresholded = diff_smoothed.lt(DIFF_UPPER_THRESHOLD);

// Display map
Map.centerObject(pt, 13);
Map.addLayer(dry, {min:-30,max:0}, 'Dry');
Map.addLayer(wet, {min:-30,max:0}, 'Wet');
Map.addLayer(wet.subtract(dry), {min:-10,max:10}, 'wet - dry', 0); 
Map.addLayer(diff_smoothed, {min:-10,max:10}, 'diff smoothed', 0); 
Map.addLayer(diff_thresholded.updateMask(diff_thresholded),
  {palette:"0000FF"},'flooded areas - blue',1);